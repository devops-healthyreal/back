<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ict.teamProject.exercise_record.impl.ERMapper">	
	<select id="getData" parameterType="String" resultType="ERDto">
	    SELECT re.* FROM (
	        SELECT r.ID as id, r.E_NAME as eName, r.ER_DATE as postDate, e.E_TYPE as eType, e.E_VIDEO_PATH as eVideoPath, e.E_CONTENT as eContent, e.calories_per_hour
	        FROM exercise_record r 
	        JOIN exercies e ON r.E_NAME = e.E_NAME
	        WHERE DATE(ER_DATE) = DATE(NOW()) and ID=#{id}
	        ORDER BY r.ER_DATE DESC
	    ) as re limit 3
	</select>
	
	<select id="getTodayData" parameterType="String" resultType="ExecRecordDto">
	    SELECT id, e_name as eName, er_date as erDate 
	    FROM exercise_record
	    WHERE ID = #{id} 
	    AND DATE(er_date) = DATE(NOW())
	</select>

	<insert id="createRecord" parameterType="ExecRecordDto">
		INSERT INTO exercise_record (id, er_date, e_name)
		values(
			#{id},
			<choose>
				<when test="erDate != null">#{erDate}</when>
				<otherwise>DATE(NOW())</otherwise>
			</choose>,
			#{eName}
		)
	</insert>
</mapper>